<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>CH559 Programming (Part 2): Using Makefile - Kali Prasad</title><meta name=Description content="CH559 Programming (Part 2): Using Makefile - Kali Prasad"><link rel=icon type=image/png href=/favicon.ico><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="CH559 Programming (Part 2): Using Makefile"><meta property="og:description" content="Bare Metal programming with CH559"><meta property="og:type" content="article"><meta property="og:url" content="https://kprasadvnsi.com/posts/bare-metal-ch559-pt2/"><meta property="og:image" content="https://kprasadvnsi.com/make_dir_struct.png"><meta property="article:published_time" content="2020-03-29T00:00:00+00:00"><meta property="article:modified_time" content="2020-03-29T00:00:00+00:00"><meta property="og:site_name" content="Kali Prasad"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kprasadvnsi.com/make_dir_struct.png"><meta name=twitter:title content="CH559 Programming (Part 2): Using Makefile"><meta name=twitter:description content="Bare Metal programming with CH559"><meta name=twitter:site content="@kprasadvnsi"><meta name=twitter:creator content="@kprasadvnsi"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"CH559 Programming (Part 2): Using Makefile","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kprasadvnsi.com\/posts\/bare-metal-ch559-pt2\/"},"image":{"@type":"ImageObject","url":"https:\/\/kprasadvnsi.com\/make_dir_struct.png","width":746,"height":396},"genre":"posts","keywords":"Bare Metal, CH559, 8051, SDCC, MCS-51, GNU-make","wordcount":570,"url":"https:\/\/kprasadvnsi.com\/posts\/bare-metal-ch559-pt2\/","datePublished":"2020-03-29T00:00:00","dateModified":"2020-03-29T00:00:00","license":"© 2020 Kali Prasad","publisher":{"@type":"Organization","name":"Kali Prasad","logo":{"@type":"ImageObject","url":"https:\/\/kprasadvnsi.com\/avatar.png","width":80,"height":80}},"author":{"@type":"Person","name":"Kali Prasad"},"description":"Bare Metal programming with CH559"}</script><link rel=preload href=https://kprasadvnsi.com/css/bundle.min.7ceb6505cb87d0614f44be28b935ac372beb44497009528d82e25ed4360ef407.css as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet type=text/css media=screen href=https://kprasadvnsi.com/css/bundle.min.7ceb6505cb87d0614f44be28b935ac372beb44497009528d82e25ed4360ef407.css></noscript><script data-ad-client=ca-pub-6490269775913302 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script>(function(w){"use strict";if(!w.loadCSS){w.loadCSS=function(){};}
var rp=loadCSS.relpreload={};rp.support=(function(){var ret;try{ret=w.document.createElement("link").relList.supports("preload");}catch(e){ret=false;}
return function(){return ret;};})();rp.bindMediaToggle=function(link){var finalMedia=link.media||"all";function enableStylesheet(){if(link.addEventListener){link.removeEventListener("load",enableStylesheet);}else if(link.attachEvent){link.detachEvent("onload",enableStylesheet);}
link.setAttribute("onload",null);link.media=finalMedia;}
if(link.addEventListener){link.addEventListener("load",enableStylesheet);}else if(link.attachEvent){link.attachEvent("onload",enableStylesheet);}
setTimeout(function(){link.rel="stylesheet";link.media="only x";});setTimeout(enableStylesheet,3000);};rp.poly=function(){if(rp.support()){return;}
var links=w.document.getElementsByTagName("link");for(var i=0;i<links.length;i++){var link=links[i];if(link.rel==="preload"&&link.getAttribute("as")==="style"&&!link.getAttribute("data-loadcss")){link.setAttribute("data-loadcss",true);rp.bindMediaToggle(link);}}};if(!rp.support()){rp.poly();var run=w.setInterval(rp.poly,500);if(w.addEventListener){w.addEventListener("load",function(){rp.poly();w.clearInterval(run);});}else if(w.attachEvent){w.attachEvent("onload",function(){rp.poly();w.clearInterval(run);});}}
if(typeof exports!=="undefined"){exports.loadCSS=loadCSS;}
else{w.loadCSS=loadCSS;}}(typeof global!=="undefined"?global:this));</script></head><body><div class="container wrapper"><div class=header><div class=avatar><a href=https://kprasadvnsi.com/><picture>
<source type=image/webp srcset=/avatar.webp><img src=/avatar.png alt="Kali Prasad"></picture></a></div><p class=site-title><a href=https://kprasadvnsi.com/>Kali Prasad</a></p><div class=site-description><p>Random blog</p><nav class="nav social"><ul class=flat><li class=li-social><a href=https://twitter.com/kprasadvnsi><i title=Twitter class="icons fab fa-twitter"></i></a></li><li class=li-social><a href=https://mastodon.social/@kprasadvnsi><i title=Mastodon class="icons fab fa-mastodon"></i></a></li><li class=li-social><a href=https://t.me/kprasadvnsi><i title=Telegram class="icons fab fa-telegram"></i></a></li><li class=li-social><a href=https://github.com/kprasadvnsi><i title=Github class="icons fab fa-github"></i></a></li><li class=li-social><a href=https://www.youtube.com/channel/UCJYk1lszl4uCf-kcCu27Ogw><i title=Youtube class="icons fab fa-youtube"></i></a></li><li class=li-social><a href=mailto:kprasadvnsi@protonmail.com><i title=Email class="icons fas fa-at"></i></a></li><li class=li-social><a href=/index.xml><i title=RSS class="icons fas fa-rss"></i></a></li></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/about>About</a></li><li><a href=/tags>Tags</a></li></ul></nav></div><div class=post><div class=author></div><div class=post-header><div class=meta><div class=date><span class=day>29</span>
<span class=rest>Mar 2020</span></div></div><div class=matter><h1 class=title>CH559 Programming (Part 2): Using Makefile</h1></div></div><div class=markdown><p>In this part, we are going to organize and clean our LED blink example that we wrote in the <a href=/posts/bare-metal-ch559-pt1/>Part-1</a> and automate the building process using <a href=https://www.gnu.org/software/make/>GNU Make</a>. Complete source code is also available on this <a href=https://github.com/kprasadvnsi/ch55x_bare_metal>GitHub Repo</a>.</p><p>We start by creating a directory named <strong>ch559</strong>. Inside directory <strong>ch559</strong> will make another directory <strong>lib</strong> and <strong>examples</strong>. The final directory structure will look similar to the image shown below.</p><p><img src=/make_dir_struct.png alt="Directory structure for make project"></p><p>Under the <strong>lib</strong> directory, we will create a header file <code>ch559.h</code> in which will put all the register definitions using SFR and SBIT macros.</p><p><code>--------------------------- ch559.h ---------------------------</code><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#579>#ifndef __CH559_H__
</span><span style=color:#579>#define __CH559_H__
</span><span style=color:#579></span>
<span style=color:#579>#include</span> <span style=color:#579>&lt;compiler.h&gt;</span><span style=color:#579>
</span><span style=color:#579></span>
<span style=color:#888>/*  Port Registers  */</span>
SFR(P1,	<span style=color:#058;font-weight:700>0x90</span>);	<span style=color:#888>// port 1 input &amp; output
</span><span style=color:#888></span>   SBIT(P1_7,	<span style=color:#058;font-weight:700>0x90</span>, <span style=color:#00d;font-weight:700>7</span>);
   SBIT(P1_6,	<span style=color:#058;font-weight:700>0x90</span>, <span style=color:#00d;font-weight:700>6</span>);
   SBIT(P1_5,	<span style=color:#058;font-weight:700>0x90</span>, <span style=color:#00d;font-weight:700>5</span>);
   SBIT(P1_4,	<span style=color:#058;font-weight:700>0x90</span>, <span style=color:#00d;font-weight:700>4</span>);
   SBIT(P1_3,	<span style=color:#058;font-weight:700>0x90</span>, <span style=color:#00d;font-weight:700>3</span>);
   SBIT(P1_2,	<span style=color:#058;font-weight:700>0x90</span>, <span style=color:#00d;font-weight:700>2</span>);
   SBIT(P1_1,	<span style=color:#058;font-weight:700>0x90</span>, <span style=color:#00d;font-weight:700>1</span>);
   SBIT(P1_0,	<span style=color:#058;font-weight:700>0x90</span>, <span style=color:#00d;font-weight:700>0</span>);

SFR(P1_DIR,	<span style=color:#058;font-weight:700>0xBA</span>);	<span style=color:#888>// port 1 direction
</span><span style=color:#888></span>SFR(PORT_CFG,	<span style=color:#058;font-weight:700>0xC6</span>);	<span style=color:#888>// port 0/1/2/3 config
</span><span style=color:#888></span>
<span style=color:#579>#endif  // __CH559_H__</span></code></pre></td></tr></table></div></div></p><p>Now we will create <code>Makefile.include</code> file under the <strong>examples</strong> directory and put the make scripts that are common for all examples.</p><p><code>----------------------- Makefile.include ----------------------</code><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-make data-lang=make><span style=color:#888>#######################################################
</span><span style=color:#888># toolchain
</span><span style=color:#888></span><span style=color:#963>CC</span> <span style=color:#333>=</span> sdcc
<span style=color:#963>OBJCOPY</span> <span style=color:#333>=</span> objcopy
<span style=color:#963>PACK_HEX</span> <span style=color:#333>=</span> packihx
<span style=color:#963>WCHISP</span> <span style=color:#333>=</span> wchisptool
<span style=color:#888>#######################################################
</span><span style=color:#888></span>
<span style=color:red;background-color:#faa>ifndef</span> <span style=color:red;background-color:#faa>FREQ_SYS</span>
<span style=color:#963>FREQ_SYS</span> <span style=color:#333>=</span> <span style=color:#60e;font-weight:700>16000000</span>
<span style=color:red;background-color:#faa>endif</span>

<span style=color:red;background-color:#faa>ifndef</span> <span style=color:red;background-color:#faa>XRAM_SIZE</span>
<span style=color:#963>XRAM_SIZE</span> <span style=color:#333>=</span> 0x1800
<span style=color:red;background-color:#faa>endif</span>

<span style=color:red;background-color:#faa>ifndef</span> <span style=color:red;background-color:#faa>XRAM_LOC</span>
<span style=color:#963>XRAM_LOC</span> <span style=color:#333>=</span> 0x0000
<span style=color:red;background-color:#faa>endif</span>

<span style=color:red;background-color:#faa>ifndef</span> <span style=color:red;background-color:#faa>CODE_SIZE</span>
<span style=color:#963>CODE_SIZE</span> <span style=color:#333>=</span> 0xF000
<span style=color:red;background-color:#faa>endif</span>

<span style=color:#963>ROOT_DIR</span> <span style=color:#333>:=</span> <span style=color:#080;font-weight:700>$(</span>dir <span style=color:#080;font-weight:700>$(</span>abspath <span style=color:#080;font-weight:700>$(</span>lastword <span style=color:#080;font-weight:700>$(</span>MAKEFILE_LIST<span style=color:#080;font-weight:700>))))</span>

<span style=color:#963>CFLAGS</span> <span style=color:#333>:=</span> -V -mmcs51 --model-small <span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span>	--xram-size <span style=color:#080;font-weight:700>$(</span>XRAM_SIZE<span style=color:#080;font-weight:700>)</span> --xram-loc <span style=color:#080;font-weight:700>$(</span>XRAM_LOC<span style=color:#080;font-weight:700>)</span> <span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span>	--code-size <span style=color:#080;font-weight:700>$(</span>CODE_SIZE<span style=color:#080;font-weight:700>)</span> <span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span>	-I<span style=color:#080;font-weight:700>$(</span>ROOT_DIR<span style=color:#080;font-weight:700>)</span>../lib -DFREQ_SYS<span style=color:#333>=</span><span style=color:#080;font-weight:700>$(</span>FREQ_SYS<span style=color:#080;font-weight:700>)</span> <span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span>	<span style=color:#080;font-weight:700>$(</span>EXTRA_FLAGS<span style=color:#080;font-weight:700>)</span>

<span style=color:#963>LFLAGS</span> <span style=color:#333>:=</span> <span style=color:#080;font-weight:700>$(</span>CFLAGS<span style=color:#080;font-weight:700>)</span>

<span style=color:#963>RELS</span> <span style=color:#333>:=</span> <span style=color:#080;font-weight:700>$(</span>C_FILES:.c<span style=color:#333>=</span>.rel<span style=color:#080;font-weight:700>)</span>

<span style=color:#06b;font-weight:700>print-%  </span><span style=color:#333>:</span> ; @echo $* = <span style=color:#080;font-weight:700>$($</span>*<span style=color:#080;font-weight:700>)</span>

<span style=color:#06b;font-weight:700>%.rel </span><span style=color:#333>:</span> %.c
	<span style=color:#080;font-weight:700>$(</span>CC<span style=color:#080;font-weight:700>)</span> -c <span style=color:#080;font-weight:700>$(</span>CFLAGS<span style=color:#080;font-weight:700>)</span> $&lt;


<span style=color:#06b;font-weight:700>$(TARGET).ihx</span><span style=color:#333>:</span> <span style=color:#080;font-weight:700>$(</span><span style=color:#963>RELS</span><span style=color:#080;font-weight:700>)</span>
	<span style=color:#080;font-weight:700>$(</span>CC<span style=color:#080;font-weight:700>)</span> <span style=color:#080;font-weight:700>$(</span>notdir <span style=color:#080;font-weight:700>$(</span>RELS<span style=color:#080;font-weight:700>))</span> <span style=color:#080;font-weight:700>$(</span>LFLAGS<span style=color:#080;font-weight:700>)</span> -o <span style=color:#080;font-weight:700>$(</span>TARGET<span style=color:#080;font-weight:700>)</span>.ihx

<span style=color:#06b;font-weight:700>$(TARGET).hex</span><span style=color:#333>:</span> <span style=color:#080;font-weight:700>$(</span><span style=color:#963>TARGET</span><span style=color:#080;font-weight:700>)</span>.ihx
	<span style=color:#080;font-weight:700>$(</span>PACK_HEX<span style=color:#080;font-weight:700>)</span> <span style=color:#080;font-weight:700>$(</span>TARGET<span style=color:#080;font-weight:700>)</span>.ihx &gt; <span style=color:#080;font-weight:700>$(</span>TARGET<span style=color:#080;font-weight:700>)</span>.hex

<span style=color:#06b;font-weight:700>$(TARGET).bin</span><span style=color:#333>:</span> <span style=color:#080;font-weight:700>$(</span><span style=color:#963>TARGET</span><span style=color:#080;font-weight:700>)</span>.ihx
	<span style=color:#080;font-weight:700>$(</span>OBJCOPY<span style=color:#080;font-weight:700>)</span> -I ihex -O binary <span style=color:#080;font-weight:700>$(</span>TARGET<span style=color:#080;font-weight:700>)</span>.ihx <span style=color:#080;font-weight:700>$(</span>TARGET<span style=color:#080;font-weight:700>)</span>.bin

<span style=color:#06b;font-weight:700>flash</span><span style=color:#333>:</span> <span style=color:#080;font-weight:700>$(</span><span style=color:#963>TARGET</span><span style=color:#080;font-weight:700>)</span>.bin pre-flash
	<span style=color:#080;font-weight:700>$(</span>WCHISP<span style=color:#080;font-weight:700>)</span> -f <span style=color:#080;font-weight:700>$(</span>TARGET<span style=color:#080;font-weight:700>)</span>.bin -g

<span style=color:#963>.DEFAULT_GOAL</span> <span style=color:#333>:=</span> all
<span style=color:#06b;font-weight:700>all</span><span style=color:#333>:</span> <span style=color:#080;font-weight:700>$(</span><span style=color:#963>TARGET</span><span style=color:#080;font-weight:700>)</span>.bin <span style=color:#080;font-weight:700>$(</span><span style=color:#963>TARGET</span><span style=color:#080;font-weight:700>)</span>.hex

<span style=color:#06b;font-weight:700>clean</span><span style=color:#333>:</span>
	rm -f <span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span>	<span style=color:#080;font-weight:700>$(</span>notdir <span style=color:#080;font-weight:700>$(</span>RELS:.rel<span style=color:#333>=</span>.asm<span style=color:#080;font-weight:700>))</span> <span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span>	<span style=color:#080;font-weight:700>$(</span>notdir <span style=color:#080;font-weight:700>$(</span>RELS:.rel<span style=color:#333>=</span>.lst<span style=color:#080;font-weight:700>))</span> <span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span>	<span style=color:#080;font-weight:700>$(</span>notdir <span style=color:#080;font-weight:700>$(</span>RELS:.rel<span style=color:#333>=</span>.mem<span style=color:#080;font-weight:700>))</span> <span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span>	<span style=color:#080;font-weight:700>$(</span>notdir <span style=color:#080;font-weight:700>$(</span>RELS:.rel<span style=color:#333>=</span>.rel<span style=color:#080;font-weight:700>))</span> <span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span>	<span style=color:#080;font-weight:700>$(</span>notdir <span style=color:#080;font-weight:700>$(</span>RELS:.rel<span style=color:#333>=</span>.rst<span style=color:#080;font-weight:700>))</span> <span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span>	<span style=color:#080;font-weight:700>$(</span>notdir <span style=color:#080;font-weight:700>$(</span>RELS:.rel<span style=color:#333>=</span>.sym<span style=color:#080;font-weight:700>))</span> <span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span>	<span style=color:#080;font-weight:700>$(</span>notdir <span style=color:#080;font-weight:700>$(</span>RELS:.rel<span style=color:#333>=</span>.adb<span style=color:#080;font-weight:700>))</span> <span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span>	<span style=color:#080;font-weight:700>$(</span>TARGET<span style=color:#080;font-weight:700>)</span>.lk <span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span>	<span style=color:#080;font-weight:700>$(</span>TARGET<span style=color:#080;font-weight:700>)</span>.map <span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span>	<span style=color:#080;font-weight:700>$(</span>TARGET<span style=color:#080;font-weight:700>)</span>.mem <span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span>	<span style=color:#080;font-weight:700>$(</span>TARGET<span style=color:#080;font-weight:700>)</span>.ihx <span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span>	<span style=color:#080;font-weight:700>$(</span>TARGET<span style=color:#080;font-weight:700>)</span>.hex <span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span>	<span style=color:#080;font-weight:700>$(</span>TARGET<span style=color:#080;font-weight:700>)</span>.bin
</code></pre></td></tr></table></div></div></p><p>We will put our LED blink example under the <strong>examples</strong> directory. Create directory <strong>blink</strong> under examples. Now make two files <code>blink.c</code> and <code>Makefile</code>.</p><p><code>--------------------------- blink.c ---------------------------</code><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#888>// Blink a LED connected to pin 1.6
</span><span style=color:#888></span>
<span style=color:#579>#include</span> <span style=color:#579>&lt;stdint.h&gt;</span><span style=color:#579>
</span><span style=color:#579>#include</span> <span style=color:#579>&lt;ch559.h&gt;</span><span style=color:#579>
</span><span style=color:#579></span>
<span style=color:#080;font-weight:700>static</span> <span style=color:#080;font-weight:700>inline</span> <span style=color:#339;font-weight:700>void</span> <span style=color:#06b;font-weight:700>delay</span>() {
    uint32_t i;
    <span style=color:#080;font-weight:700>for</span> (i <span style=color:#333>=</span> <span style=color:#00d;font-weight:700>0</span>; i <span style=color:#333>&lt;</span> (<span style=color:#00d;font-weight:700>120000UL</span>); i<span style=color:#333>++</span>){}
        __asm__(<span style=background-color:#fff0f0>&#34;nop&#34;</span>);
}

<span style=color:#339;font-weight:700>void</span> <span style=color:#06b;font-weight:700>main</span>() {
	PORT_CFG <span style=color:#333>=</span> <span style=color:#00d;font-weight:700>0</span>b00101101;
    P1_DIR <span style=color:#333>=</span> <span style=color:#00d;font-weight:700>0</span>b11110000;
	P1 <span style=color:#333>=</span> <span style=color:#058;font-weight:700>0x00</span>;

	<span style=color:#080;font-weight:700>while</span> (<span style=color:#00d;font-weight:700>1</span>) {
		delay();
		P1_6 <span style=color:#333>=</span> <span style=color:#333>!</span>P1_6;
	}
}</code></pre></td></tr></table></div></div></p><p><code>-------------------------- Makefile ---------------------------</code><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-make data-lang=make><span style=color:#963>TARGET</span> <span style=color:#333>=</span> blink

<span style=color:#963>C_FILES</span> <span style=color:#333>=</span> <span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span>	blink.c

<span style=color:red;background-color:#faa>include</span> <span style=color:red;background-color:#faa>../Makefile.include</span>
</code></pre></td></tr></table></div></div></p><p>Its time to build our LED Blink example. Goto the <strong>blink</strong> directory and execute the command make. This will compile our example and produce a binary file for programming the CH559 board.</p></div><div class=tags><div class=taxosfloating_left><p>Tags</p></div><div class=termsfloating_right><p><a href=/tags/8051/>8051</a>
<a href=/tags/bare-metal/>bare-metal</a>
<a href=/tags/ch559/>ch559</a>
<a href=/tags/gnu-make/>gnu-make</a>
<a href=/tags/mcs-51/>mcs-51</a>
<a href=/tags/sdcc/>sdcc</a></p></div><div class=clearit></div></div></div></div><div class="footer wrapper"><nav class=nav><div class=footertext>© 2020 Kali Prasad</div></nav></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-161815915-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>